<h2>Vehicle List</h2>
<!-- Search Bar -->
<div class="search-container">
  <input
    nz-input
    type="text"
    [(ngModel)]="searchQuery"
    (ngModelChange)="onSearch()"
    placeholder="Search by car model..."
  />
  <button (click)="onSearch()">Search</button>
</div>
<!-- Shows only when isLoading = true -->
<div *ngIf="isLoading">Loading vehicles...</div>
<div *ngIf="error" class="error">{{ error }}</div>

<!-- Table Display -->
<div *ngIf="!isLoading && !error && vehicles.length > 0" class="table-container">
  <table>
    <thead>
      <tr>
        <th>Car Make</th>
        <th>Car Model</th>
        <th>Age (Years)</th>
        <th>Owner Name</th>
        <th>Email</th>
        <th>VIN</th>
        <th>Manufactured Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let vehicle of vehicles">
        <td>{{ vehicle.car_make }}</td>
        <td>{{ vehicle.car_model }}</td>
        <td>{{ vehicle.age_of_vehicle }}</td>
        <td>{{ vehicle.first_name }} {{ vehicle.last_name }}</td>
        <td>{{ vehicle.email }}</td>
        <td>{{ vehicle.vin }}</td>
        <td>{{ vehicle.manufactured_date }}</td>
        <td class="actions-cell">
          <button class="btn-edit" (click)="onEdit(vehicle)" [disabled]="isDeleting">
            Edit
          </button>
          <button class="btn-delete" (click)="onDelete(vehicle.id)" [disabled]="isDeleting">
            Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<p *ngIf="!isLoading && !error && vehicles.length === 0">
  No vehicles found.
</p>
<!-- Pagination Controls -->
<div class="pagination" *ngIf="!isLoading && !error">
  <button (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
  <span>Page {{ currentPage }}</span>
  <button (click)="nextPage()">Next</button>
</div>

<!-- Edit Modal -->
<nz-modal
  [(nzVisible)]="isEditModalVisible"
  nzTitle="Edit Vehicle"
  [nzFooter]="modalFooter"
  (nzOnCancel)="handleCancelEdit()"
  nzWidth="600px"
>
  <ng-container *nzModalContent>
    <form *ngIf="editingVehicle" class="edit-form">
      <div class="form-row">
        <div class="form-group">
          <label for="first_name">First Name <span class="required">*</span></label>
          <input
            nz-input
            id="first_name"
            [(ngModel)]="editingVehicle.first_name"
            name="first_name"
            placeholder="Enter first name"
            required
          />
        </div>

        <div class="form-group">
          <label for="last_name">Last Name <span class="required">*</span></label>
          <input
            nz-input
            id="last_name"
            [(ngModel)]="editingVehicle.last_name"
            name="last_name"
            placeholder="Enter last name"
            required
          />
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email <span class="required">*</span></label>
        <input
          nz-input
          id="email"
          type="email"
          [(ngModel)]="editingVehicle.email"
          name="email"
          placeholder="Enter email"
          required
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="car_make">Car Make <span class="required">*</span></label>
          <input
            nz-input
            id="car_make"
            [(ngModel)]="editingVehicle.car_make"
            name="car_make"
            placeholder="Enter car make"
            required
          />
        </div>

        <div class="form-group">
          <label for="car_model">Car Model <span class="required">*</span></label>
          <input
            nz-input
            id="car_model"
            [(ngModel)]="editingVehicle.car_model"
            name="car_model"
            placeholder="Enter car model"
            required
          />
        </div>
      </div>

      <div class="form-group">
        <label for="vin">VIN</label>
        <input
          nz-input
          id="vin"
          [(ngModel)]="editingVehicle.vin"
          name="vin"
          placeholder="Vehicle Identification Number"
          disabled
        />
        <small class="help-text">VIN cannot be modified</small>
      </div>

      <div class="form-group">
        <label for="manufactured_date">Manufactured Date</label>
        <input
          nz-input
          id="manufactured_date"
          type="date"
          [(ngModel)]="editingVehicle.manufactured_date"
          name="manufactured_date"
        />
      </div>
    </form>
  </ng-container>

  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handleCancelEdit()" [disabled]="isUpdating">
      Cancel
    </button>
    <button 
      nz-button 
      nzType="primary" 
      (click)="handleSaveEdit()" 
      [nzLoading]="isUpdating"
      [disabled]="isUpdating"
    >
      {{ isUpdating ? 'Saving...' : 'Save Changes' }}
    </button>
  </ng-template>
</nz-modal>